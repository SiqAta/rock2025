<!DOCTYPE html>
<html lang="fi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Kuopiorock 2025 Aikataulu</title>
    <link rel="stylesheet" href="style.css" />
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Roboto&display=swap" rel="stylesheet">

</head>
<body>
    <header>
        <h1>Kuopiorock 2025</h1>
        <p>Festivaaliaikataulu</p>
    </header>

    <div>
        <button class="tab-button active" data-day="Torstai">Torstai 24.7.</button>
        <button class="tab-button" data-day="Perjantai">Perjantai 25.7.</button>
        <button class="tab-button" data-day="Lauantai">Lauantai 26.7.</button>
    </div>

    <div id="timeline-table"></div>

    <script src="schedule.js"></script>
    <script>
        const SLOT_MINUTES = 5;
        const START_MINUTES = 14 * 60; // 14:00
        const END_MINUTES = 26 * 60;   // 02:00 seuraavana päivänä
        const TIME_SLOTS = [];

        for (let m = START_MINUTES; m <= END_MINUTES; m += SLOT_MINUTES) {
            let hour = Math.floor(m / 60) % 24;
            let minute = m % 60;
            TIME_SLOTS.push(`${String(hour).padStart(2, "0")}:${String(minute).padStart(2, "0")}`);
        }

        const stageOrder = [
            "Kuopio250 Stage",
            "Matkus Stage",
            "Savonia Stage",
            "Väinö Stage"
        ];

        function timeToMinutes(time) {
            const [h, m] = time.split(":").map(Number);
            return h * 60 + m;
        }

        function timeToMinutesWithNextDay(endTime, startTime) {
            let endMinutes = timeToMinutes(endTime);
            if (endMinutes < startTime) {
                endMinutes += 24 * 60;
            }
            return endMinutes;
        }

        function createCell(text, className) {
            const cell = document.createElement("div");
            cell.className = className;
            cell.textContent = text;
            return cell;
        }

        function renderSchedule(dayName) {
            const timeline = document.getElementById("timeline-table");
            timeline.innerHTML = "";

            const dayData = kuopioRockData.find(d => d.paiva === dayName);
            if (!dayData) return;

            // Järjestä lavat oikeaan järjestykseen
            const stagesSet = new Set(dayData.esiintymiset.map(e => e.lava));
            const stagesOrdered = [];

            stageOrder.forEach(stage => {
                if (stagesSet.has(stage)) {
                    stagesOrdered.push(stage);
                    stagesSet.delete(stage);
                }
            });
            stagesSet.forEach(stage => stagesOrdered.push(stage));

            const colsCount = TIME_SLOTS.length + 1; // label + timeslots

            // Otsikkorivi
            timeline.appendChild(createCell("Klo", "header-cell klo"));
            TIME_SLOTS.forEach(slot => {
                const [h, m] = slot.split(":").map(Number);
                const isHourOrHalf = m === 0 || m === 30;
                const cell = createCell(isHourOrHalf ? slot : "", "header-cell");
                if (isHourOrHalf) {
                    cell.style.borderLeft = "1px solid #555";
                }
                timeline.appendChild(cell);
            });

            // Rivit lavalle ja tyhjät solut
            stagesOrdered.forEach(stage => {
                timeline.appendChild(createCell(stage, "label-cell"));
                TIME_SLOTS.forEach(() => {
                    const cell = document.createElement("div");
                    cell.className = "performance-cell";
                    timeline.appendChild(cell);
                });
            });

            // Map lava -> rivi indeksi
            const stageMap = {};
            stagesOrdered.forEach((stage, idx) => (stageMap[stage] = idx));

            // Yhden sarakkeen leveys pikseleinä, css:ssä 40px
            const cellWidth = 40;

            // Lisää esiintymiset
            dayData.esiintymiset.forEach(perf => {
                const startMinutes = timeToMinutes(perf.aika_alku);
                const endMinutes = timeToMinutesWithNextDay(perf.aika_loppu, startMinutes);
                const durationMinutes = endMinutes - startMinutes;
                if (durationMinutes <= 0) return;

                // Start slot indeksi TIME_SLOTS-taulukosta
                const startIndex = TIME_SLOTS.findIndex(t => {
                    let tMin = timeToMinutes(t);
                    if (tMin < START_MINUTES) tMin += 24 * 60;
                    return tMin === startMinutes;
                });
                if (startIndex === -1) return;

                const row = stageMap[perf.lava];
                if (row === undefined) return;

                const widthSlots = durationMinutes / SLOT_MINUTES;
                const cellIndex = (row + 1) * colsCount + (startIndex + 1);

                const allCells = timeline.querySelectorAll(".performance-cell");
                const cell = allCells[cellIndex - colsCount];
                if (cell) {
                    const box = document.createElement("div");
                    box.className = "performance-box";
                    box.textContent = perf.artisti;

                    box.style.width = `${widthSlots * cellWidth - 4}px`; // -4 for padding/margin
                    cell.appendChild(box);
                }
            });
        }

        document.querySelectorAll(".tab-button").forEach(btn => {
            btn.addEventListener("click", () => {
                document.querySelectorAll(".tab-button").forEach(b => b.classList.remove("active"));
                btn.classList.add("active");
                renderSchedule(btn.dataset.day);
            });
        });

        window.addEventListener("DOMContentLoaded", () => renderSchedule("Torstai"));
    </script>
</body>
</html>
